ErrorDocument 401 /index.php?do=404
ErrorDocument 403 /index.php?do=404
ErrorDocument 404 /index.php?do=404
  
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
 
Options +FollowSymLinks
# Evitar escaneos y cualquier intento de manipulación malintencionada
# de la URL. Con esta regla es imposible lanzar ataques de inyección (SQL, XSS, etc)
RewriteCond %{HTTP_USER_AGENT} ^$ [OR]
RewriteCond %{HTTP_USER_AGENT} ^(-|\\.|\') [OR]
RewriteCond %{HTTP_USER_AGENT} ^(.*)(<|>|%3C|%3E)(.*) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(java|curl|wget)(.*) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(.*)(libwww-perl|libwwwperl|snoopy|curl|wget|winhttp|python|nikto|scan|clshttp|archiver|loader|email|harvest|fetch|extract|grab|miner|suck|reaper|leach)(.*) [NC,OR]
 
RewriteCond %{REQUEST_URI} ^(/,|/;|/<|/>|/\'|/`|/%2C|/%3C|/%3E|/%27|/////) [NC,OR]
RewriteCond %{HTTP_REFERER} ^(.*)(%00|%08|%09|%0A|%0B|%0C|%0D|%0E|%0F|%2C|<|>|\'|%3C|%3E|%26%23|%27|%60)(.*) [NC,OR]
RewriteCond %{QUERY_STRING} ^(.*)(%00|%08|%09|%0A|%0B|%0C|%0D|%0E|%0F|%2C|%3C|%3E|%27|%26%23|%60)(.*) [NC,OR]
RewriteCond %{QUERY_STRING} ^(.*)(\'|-|<|>|,|/|\\\\|\\.a|\\.c|\\.t|\\.d|\\.p|\\.i|\\.e|\\.j)(.*) [NC,OR]
RewriteCond %{HTTP_COOKIE} ^(.*)(<|>|\'|%3C|%3E|%27)(.*) [NC]
 
## Evitar que se liste el contenido de los directorios
Options All -Indexes
## Lo mismo que lo anterior
IndexIgnore *
# Protegerse contra los ataques DOS limitando el tamaño de subida de archivos
LimitRequestBody 10240000

#  -----------  REESCRIBIMOS NUEVOS DIRECTORIOS ----------- #
# --- INDEX --- #
RewriteRule ^$ index.php [QSA,L]

# --- PAGINAS SOLICITDAS --- #
RewriteRule ^signup$ index.php?do=signup [QSA,L]
RewriteRule ^templates(\/|)$ index.php?do=templates [QSA,L]
RewriteRule ^feedbacks/new$ index.php?do=contact [QSA,L]
RewriteRule ^about/safety$ index.php?do=safety [QSA,L]
RewriteRule ^about/tos$ index.php?do=tos [QSA,L]
RewriteRule ^about/privacy(\/|)$ index.php?do=privacy [QSA,L]
RewriteRule ^about/logos$ index.php?do=logos [QSA,L]
RewriteRule ^signup/optional$ index.php?do=optional [QSA,L]
RewriteRule ^account/wall$ index.php?do=wall [QSA,L]
RewriteRule ^account/popular$ index.php?do=popular [QSA,L]
RewriteRule ^account/questions$ index.php?do=questions [QSA,L]
RewriteRule ^account/notifications/answers$ index.php?do=notify_answer [QSA,L]
RewriteRule ^remind/request$ index.php?do=request [QSA,L]
RewriteRule ^account/settings/profile$ index.php?do=settings&nav=profile [QSA,L]
RewriteRule ^account/settings/privacy$ index.php?do=settings&nav=privacy [QSA,L]
RewriteRule ^account/settings/design$ index.php?do=settings&nav=design [QSA,L]
RewriteRule ^account/settings/services$ index.php?do=settings&nav=services [QSA,L]

# --- ENLACES --- #
RewriteRule ^widgets/compartir(\/|)$ index.php?do=extra&act=compartir [QSA,L]
RewriteRule ^privacidad-de-datos(\/|)$ index.php?do=extra&act=privacidad-de-datos [QSA,L]
RewriteRule ^terminos-y-condiciones(\/|)$ index.php?do=extra&act=terminos-y-condiciones [QSA,L]
RewriteRule ^takedown-notice.php$ index.php?do=extra&act=takedown-notice [QSA,L]
RewriteRule ^denuncia-publica(\/|)$ index.php?do=extra&act=denuncia-publica [QSA,L]
RewriteRule ^protocolo(\/|)$ index.php?do=extra&act=protocolo [QSA,L]

# --- SOLICITUD AJAX --- #
RewriteRule ^ajax/([A-Za-z0-9_-]+)(\/|)$ ajax.php?file=$1&ajax=1 [QSA,L]
RewriteRule ^logout/ w_inc/ajax.php?file=login-salir.php [QSA,L]

# --- PERFIL --- #
RewriteRule ^([A-Za-z0-9_-]+)$ index.php?do=perfil&u_name=$1 [QSA,L]
RewriteRule ^([A-Za-z0-9_-]+)/$ index.php?do=perfil&u_name=$1 [QSA,L]
RewriteRule ^([A-Za-z0-9_-]+)/questions/([0-9]+)/reply$ index.php?do=questions&user=$1&quest_id=$2 [QSA,L]
RewriteRule ^([A-Za-z0-9_-]+)/answer/([0-9]+)(\/|)$ index.php?do=perfil&u_name=$1&answerid=$2 [QSA,L]
RewriteRule ^perfil/([A-Za-z0-9_-]+)$ index.php?do=perfil&u_name=$1 [QSA,L]
RewriteRule ^perfil/([A-Za-z0-9_-]+)/$ index.php?do=perfil&u_name=$1 [QSA,L]


<FilesMatch "\.(htaccess|ini|log|cfg)$">
Order Allow,Deny
Deny from all
</FilesMatch>

# php -- BEGIN cPanel-generated handler, do not edit
# Set the â€œea-php56â€ package as the default â€œPHPâ€ programming language.
<IfModule mime_module>
  AddHandler application/x-httpd-ea-php56___lsphp .php .php5 .phtml
</IfModule>
# php -- END cPanel-generated handler, do not edit
